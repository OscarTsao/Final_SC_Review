# LOCKED BEST CONFIGURATION FOR PAPER DEPLOYMENT
# Updated: 2026-01-17 based on HPO model zoo results
# Best combo: nv-embed-v2 + jina-reranker-v3 (nDCG@10 = 0.8658)
# Status: LOCKED - DO NOT MODIFY without running full validation

paths:
  data_dir: data
  groundtruth: data/groundtruth/evidence_sentence_groundtruth.csv
  sentence_corpus: data/groundtruth/sentence_corpus.jsonl
  cache_dir: data/cache/nv-embed-v2

models:
  # Best retriever from HPO (nv-embed-v2)
  retriever_name: nv-embed-v2
  retriever_model_id: nvidia/NV-Embed-v2
  retriever_max_length: 512
  retriever_batch_size: 8
  retriever_query_prefix: "Instruct: Given a criterion, retrieve sentences that provide direct supporting evidence.\nQuery: "
  retriever_trust_remote_code: true
  retriever_use_4bit: false

  # Best reranker from HPO (jina-reranker-v3)
  reranker_name: jina-reranker-v3
  reranker_model_id: jinaai/jina-reranker-v3
  reranker_max_length: 1024
  reranker_chunk_size: 128
  reranker_dtype: auto
  reranker_use_listwise: true
  reranker_trust_remote_code: true

retriever:
  # Best HPO parameters for inference
  top_k_retriever: 24
  top_k_final: 10
  use_sparse: false
  use_colbert: false
  use_multiv: false
  fusion_method: rrf
  score_normalization: none
  rrf_k: 60
  rebuild_cache: false

split:
  seed: 42
  train_ratio: 0.8
  val_ratio: 0.1
  test_ratio: 0.1

evaluation:
  split: val  # Default to val; change to test ONLY for final locked run
  ks: [1, 3, 5, 10, 20]
  skip_no_positives: true
  save_query_csv: true

# DEPLOYMENT POSTPROCESSING (GNN-enhanced)
postprocessing:
  # P4 Criterion-Aware NE Gate (AUROC=0.8967, F1=0.6973)
  no_evidence_detector:
    method: criterion_aware_gnn
    model_path: outputs/gnn_research/*/models/p4_*.pt
    auroc: 0.8967
    f1: 0.6973
    threshold: 0.5

  # P3 Graph Reranker (MRR +37.1%, Recall@5 +38.4%)
  graph_reranker:
    enabled: true
    model_path: outputs/gnn_research/*/models/p3_*.pt
    alpha: 0.3
    mrr_improvement: 0.371

  # P2 Dynamic-K Selection (Avg K=5.01, Evidence Recall=88.70%)
  dynamic_k:
    method: mass
    gamma: 0.8
    k_min: 2
    k_max: 10
    avg_k: 5.01
    evidence_recall: 0.887

# GNN model performance summary
gnn_models:
  p1_ne_gate:
    auroc: 0.6052
    description: "Basic NE Gate (graph-level classification)"
  p2_dynamic_k:
    avg_k: 5.01
    evidence_recall: 0.887
    hit_rate: 0.9005
    description: "Dynamic-K with mass policy (gamma=0.8)"
  p3_graph_reranker:
    mrr_delta: 0.371
    recall5_delta: 0.384
    ndcg1_delta: 1.289
    description: "Graph-enhanced score refinement"
  p4_criterion_aware:
    auroc: 0.8967
    f1: 0.6973
    accuracy: 0.9127
    description: "Criterion-conditioned NE detection"

# HPO metadata
metadata:
  created: "2026-01-08"
  updated: "2026-01-17"
  hpo_combo: "nv-embed-v2 + jina-reranker-v3"
  hpo_ndcg10: 0.8658
  hpo_n_trials: 50
  hpo_total_combos: 324
  description: "Best configuration from HPO model zoo experiments with GNN enhancements"
