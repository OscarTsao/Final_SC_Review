# FINAL TEST EVALUATION CONFIG - LOCKED
# Updated: 2026-01-17 based on HPO model zoo results
# Best combo: nv-embed-v2 + jina-reranker-v3 (nDCG@10 = 0.8658)
# DO NOT MODIFY - Use for final test evaluation only

paths:
  data_dir: data
  groundtruth: data/groundtruth/evidence_sentence_groundtruth.csv
  sentence_corpus: data/groundtruth/sentence_corpus.jsonl
  cache_dir: data/cache/nv-embed-v2

models:
  # Best retriever from HPO (nv-embed-v2)
  retriever_name: nv-embed-v2
  retriever_model_id: nvidia/NV-Embed-v2
  retriever_max_length: 512
  retriever_batch_size: 8
  retriever_query_prefix: "Instruct: Given a criterion, retrieve sentences that provide direct supporting evidence.\nQuery: "
  retriever_trust_remote_code: true
  retriever_use_4bit: false

  # Best reranker from HPO (jina-reranker-v3)
  reranker_name: jina-reranker-v3
  reranker_model_id: jinaai/jina-reranker-v3
  reranker_max_length: 1024
  reranker_chunk_size: 128
  reranker_dtype: auto
  reranker_use_listwise: true
  reranker_trust_remote_code: true

# Best HPO parameters (from 50 trials on nv-embed-v2 + jina-reranker-v3)
retriever:
  top_k_retriever: 24
  top_k_final: 10
  use_sparse: false  # nv-embed-v2 is dense-only
  use_colbert: false  # nv-embed-v2 is dense-only
  use_multiv: false
  fusion_method: rrf
  score_normalization: none
  rrf_k: 60
  rebuild_cache: false

# GNN postprocessing params (P3-P4)
postprocessing:
  # P4 NE Gate
  ne_detector:
    method: criterion_aware_gnn
    auroc: 0.8967
  # P3 Graph Reranker
  graph_reranker:
    enabled: true
    alpha: 0.3

split:
  seed: 42
  train_ratio: 0.8
  val_ratio: 0.1
  test_ratio: 0.1

evaluation:
  split: test
  ks: [1, 3, 5, 10, 20]
  skip_no_positives: false  # Include all queries for deployment metrics
  save_query_csv: true

# Metadata
metadata:
  created: "2026-01-09"
  updated: "2026-01-17"
  hpo_combo: "nv-embed-v2 + jina-reranker-v3"
  hpo_ndcg10: 0.8658
  hpo_n_trials: 50
  hpo_total_combos: 324
